<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
        <!-- CSS only -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

        <!-- JavaScript Bundle with Popper -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>

        <!-- Font-Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">


    </head>

    <style>
        @media (max-width:280px) {
            #padd{
                padding: 0px 13px;
            }
        }
    </style>
    <body id="body">
            <div class="navbar container bg-light justify-content-between rounded" id="topNav">
                <div class="container fs-3 ">
                    <a href="account-details.html" class="text-decoration-none text-dark" style="height: 50px;" >
                        <i class="fa-solid fa-user text-light btn text-center rounded rounded-circle" style="background-color: #590140; width: 40px;height: 40px;line-height: 25px;" onclick="profileDetails()" type="butt" data-bs-toggle="modal" data-bs-target="#exampleModal2"></i>
                        <span id="helloUser" class="text-capitalize h6"></span>
                    </a>

                    <div class="btn" onclick="notify()" style="border: none;">
                        <i class="fa-regular fa-bell fa-blow fs-2 position-relative"  style="color:#B10180;" >
                            <span class="position-absolute top-0 start-100 translate-middle 0- bg-danger border border-light rounded-circle text-light" style="width: 20px; height:20px; line-height:20px; font-size: 8px; " id="badgeNo">
                                99
                                <span class="visually-hidden">New alerts</span>
                            </span>
                        </i>
                    </div>
                </div>    
            </div>


            <div class="mt-3 col-11 col-md-10 m-auto rounded" style="background-color: #590140;">
                <div class="container">
                    <div class="d-flex justify-content-between ">
                        <div class="mt-4 text-light">
                            <small>Total Balance</small> 
                            <span  style="border: none;" onclick="displayBalance()" id="dispBalance">
                                <i class="fa-solid fa-eye btn text-light"></i>
                            </span>
                        </div><hr>

                        <small  class="mt-4 ms-auto text-center text-light" >
                            <small class="text-center m-auto">Account Number</small> <br>
                            <i type="button" data-bs-toggle="popover" data-bs-placement="top" data-bs-content="Account Number copied to Clipboard" class="fa-solid fa-copy btn rounded rounded-circle text-center text-light" style="height: 40px; line-height:25px" id="copyAccNo">   
                            </i>
                            <span id="dispAccNo" class="fw-bold"></span>
                        </small>
                    </div><br>

                    <div class="d-flex justify-content-between text-light">
                        <small  class="fw-bold h6">
                            <span>&#8358;</span>
                            <span id="accountBalance"></span>
                        </small><br>
                        <small class="ms-auto text-light btn btn-sm" type="butt" data-bs-toggle="modal" data-bs-target="#exampleModal1" id="transactionHistory">Transaction History
                            <i class="fa-solid fa-angle-right"></i>
                        </small>
                    </div><br>
                </div>
            </div>

            <div class="mt-3 col-11 col-md-6 m-auto rounded border" id="quicklinks">
                <div class="container mt-3 mb-3">
                    <div class="m-2 fw-bold">Quick  Links</div>
                    <div class="d-flex justify-content-evenly container-fluid mb-2" id="flex1">
                        <span data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@getbootstrap" class="btn border p-0 bg-light m-1 p-1" style="width:65px;" id="mee">
                            <i class="fa-solid fa-arrow-right-arrow-left"></i><br> Transfer</span>
                        <span class="btn border p-0 bg-light m-1 p-1" style="width:65px;" >
                            <i class="fa-solid fa-signal mx-2 px-2"></i><br> Topup</span>
                        <span class="btn border p-0 bg-light m-1 p-2 mx-1 " style="width:65px;">
                            <i class="fa-solid fa-globe"></i><br> Data</span>
                        <span class="btn border p-0 bg-light m-1 p-1" style="width:65px;"  >
                            <i class="fa-solid fa-tv p" id="padd"></i><br> TV</span>
                    </div>

                    <div class="d-flex justify-content-evenly container-fluid" id="flex2">
                        <span class="btn border p-0 bg-light m-1 p-1" style="width: 65px; font-size: 13px;">
                            <i class="fa-solid fa-lightbulb" style="font-size: 15px;"></i><br> Electricity</span>
                        <span class="btn border p-0 bg-light m-1 p-1" style="width: 65px;">
                            <i class="fa-solid fa-volleyball"></i><br> Betting</span>
                        <span class="btn border p-0 bg-light m-1 p-1" style="width: 65px;">
                            <i class="fa-solid fa-shopping-bag"></i><br>Deals</span>
                        <span class="btn border p-0 bg-light m-1 p-1" style="width: 65px;">
                            <i class="fa-solid fa-circle-info"></i><br> others</span>
                    </div><br>
                

                </div>
            </div>
            



            <!-- <div class="d-flex justify-content-evenly " style="gap: 5px;">
                <button class="btn btn-light">Add Money</button>
                <button type="button" class="btn btn-light btn-small"  data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@getbootstrap" >
                    <i class="fa-sharp fa-solid fa-arrow-right-arrow-left" style="color: #590140;"></i>
                    Transfer
                </button>
                <button class="btn btn-light" onclick="withdraw()"><i class="fa-solid fa-inbox-out"></i> Withdraw</button>
            </div> -->


            <!-- Modal for Transfer -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen">
                <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Transfer</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    <small> </small>
                </div>
                <div class="modal-body">
                    <form>
                    <div class="mb-3">
                        <label for="message-text" class="col-form-label">Account Number:</label>
                        <input type="number" class="form-control" id="transferTo" placeholder="Transfer To">
                        <small id="accountName" class="text-success fw-bold"></small>
                    </div>
                    <div class="mb-3">
                        <label for="recipient-name" class="col-form-label">Amount:</label>
                        <input type="number" class="form-control" id="transferAmount" placeholder="Transfer amount">
                        <small id="insufficientBalance" class="text-danger fw-bold"></small>
                    </div> 
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="transfer()" id="sendMoney" data-bs-dismiss="modal">Send</button>
                </div>
                </div>
            </div>
            </div>


            <!-- Modal For Transaction History -->
            <div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-fullscreen">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel1">Transaction History </h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" id="transactionDetails">
                            <div class="d-flex justify-content-between">
                                <small>Recent Transaction</small>
                                <div>
                                    <small>Category</small>
                                    <select name="" id="category" >
                                        <option value="all" class="text-dark" onclick="displayIn()">All</option>
                                        <option value="in" class="text-success" >In</option>
                                        <option value="out" class="text-danger" >Out</option>
                                    </select>
                                </div>
                                </small>
                            </div>
                            <div class="mt-3">
                                <div id="dispHistory" class="">
                                    
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Modal For User Details -->
            <div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-fullscreen">
                <div class="modal-content">
                    <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel1">ACCOUNT DETAILS</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body bg-info" id="userDetails">

                    </div>
                    <div class="modal-footer d-flex justify-content-between">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                            <i class="fa-solid fa-user-pen"></i>
                        </button>
                        <button type="button" class="btn btn-danger ms-auto" onclick="signOut()">SIGN-OUT</button>
                    </div>
                </div>
                </div>
            </div>

            
            <!-- Modal for Edit user details-->
            <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">Modal title</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                    ...
                    </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"  type="butt" data-bs-toggle="modal" data-bs-target="#exampleModal2">Close</button>
                    <button type="button" class="btn btn-primary"  type="butt" data-bs-toggle="modal" data-bs-target="#exampleModal2">Understood</button>
                    </div>
                </div>
                </div>
            </div>


        <div class="navbar bg-light justify-content-evenly container-fluid fixed-bottom" id="bottomNav" > 

            <div style="width:40px; height:40px; line-height: 20px; background-color: #590140;" class="btn text-light rounded rounded-circle text-center p-2">
                <i class="fa-solid fa-house "></i>
            </div>

            <div style="width:40px; height:40px; line-height: 20px; background-color: #590140;" class="btn text-light rounded rounded-circle text-center fs-4 p-2">                
                <i class="fa-regular fa-gem"></i>
            </div>

            <div style="width:40px; height:40px; line-height: 20px; background-color: #590140;" class="btn fs-2 text-light rounded rounded-circle text-center p-2" onclick="on()" id="mode">
                
            </div>

            <div style="width:40px; height:40px; line-height: 20px; background-color: #590140;" class="btn  text-light rounded rounded-circle text-center p-2">
                <i class="fa-regular fa-credit-card"></i>
            </div>

            <div style="width:40px; height:40px; line-height: 20px; background-color: #590140;" class="btn text-light rounded rounded-circle text-center p-2">
                <i class="fa-solid fa-user"  ></i>
            </div>
        </div>


    </body>


    <script>
        var allUsers = []
        var onlineUser = {}
        var allTransfer = []
        var turnOnDarkMode = false
        var displayMyBalance = false
        var onlineUserTransactionDetails
        var debitTransactions
        var creditTransactions
        var moneySent = false
        let countNotification = 0
        let transactionId = (Math.floor(Math.random()*10000000000 - 90000000000)+1000000000 )*-1
        console.log(transactionId)
        const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
        const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))
        
        if (localStorage.usersList && localStorage.currentUser){
            allUsers = JSON.parse(localStorage.getItem("usersList"))
            onlineUser = JSON.parse(localStorage.getItem("currentUser"))
            allTransfer = JSON.parse(localStorage.getItem("transferList"))
            // onlineUserTransactionDetails = JSON.parse(localStorage.getItem("onlineUserTrans"))
            debitTransactions = JSON.parse(localStorage.getItem("debitTrans"))
            creditTransactions = JSON.parse(localStorage.getItem("creditTrans"))

            onlineUserTransactionDetails = allTransfer.filter((item, index)=> item.senderAccountNumber == onlineUser.accountnumber || item.recieverAccountNumber==onlineUser.accountnumber)
            console.log("onlineUserTransDetails")
            console.log(onlineUserTransactionDetails)

            console.log("All Users")
            console.log(allUsers)
            console.log("All Transfer Made")
            console.log(allTransfer)
            console.log(debitTransactions)
            display()
        }else{
            window.location="index.html"
        }



        function display(){
            helloUser.innerHTML=`Hello, ${onlineUser.firstname}` 
            accountBalance.innerHTML= `${onlineUser.accountbalance}.00`
            dispAccNo.innerText =  `${onlineUser.accountnumber}`
            onlineUserTransactionDetails = allTransfer.filter((item, index)=> item.senderAccountNumber == onlineUser.accountnumber || item.recieverAccountNumber==onlineUser.accountnumber)
            console.log("dips")
            console.log(onlineUserTransactionDetails)

            if (onlineUserTransactionDetails!==null){
                debitTransactions = onlineUserTransactionDetails.filter((item, index) => item.senderAccountNumber == onlineUser.accountnumber)
                creditTransactions = onlineUserTransactionDetails.filter((item, index) => item.recieverAccountNumber == onlineUser.accountnumber)
                console.log("debitTransactions")
                console.log(debitTransactions)
                console.log("creditTransactions")
                console.log(creditTransactions)
                debitTransactions.reverse()
                creditTransactions.reverse()
                if (debitTransactions!==""){
                    // alert("HEllo")
                    debitTransactions.map((item, index)=>{ 
                    dispHistory.innerHTML+=
                    `
                    <div class="p-3 mt-3  rounded" style="background-color:#590140">
                        <div class="d-flex justify-content-between">
                            <small class="fw-bold text-light">Transfer to ${item.recieverFirstname}</small>
                            <small class="fw-bold text-light">${item.dateSent} ${item.timeSent}</small>
                        </div>
                        <details class="text-light">
                            <div class="d-flex justify-content-between">
                                <span class="text-light ">STATUS:</span> 
                                <span class="fw-bold">SUCCESS</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-light ">Transferred to:</span>
                                <span class="fw-bold"> ${item.recieverFirstname} ${item.recieverLastname}<span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-light ">Account Number:</span>
                                <span class="fw-bold">${item.recieverAccountNumber}</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-light ">Amount Transferred:</span>
                                <span class="fw-bold">&#8358;${item.amountTransferred}.00</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-light ">Transaction ID:</span>
                                <span class="fw-bold">${item.transactionId}0000</span>
                            </div>
                        </details>
                    </div>
                    `
                    })
                }

                if (creditTransactions !==""){
                    creditTransactions.map((item, index)=>{ 
                    dispHistory.innerHTML+=
                    `
                    <div class="p-3 mt-3  rounded" style="background-color:#590140">
                        <div class="d-flex justify-content-between">
                            <small class="fw-bold text-light">Recieved money from ${item.senderFirstname}</small>
                            <small class="fw-bold text-light">${item.dateSent} ${item.timeSent}</small>
                        </div>
                        <details class="text-light">
                            <div class="d-flex justify-content-between">
                                <span class="text-light ">STATUS:</span> 
                                <span class="fw-bold">SUCCESS</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-light ">Transferred to:</span>
                                <span class="fw-bold"> ${item.senderFirstname} ${item.senderLastname}<span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-light ">Account Number:</span>
                                <span class="fw-bold">${item.senderAccountNumber}</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-light ">Amount Recieved:</span>
                                <span class="fw-bold">&#8358;${item.amountRecieved}.00</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-light ">Transaction ID:</span>
                                <span class="fw-bold">${item.transactionId}0000</span>
                            </div>
                        </details>
                    </div>
                    `
                })
                }
            }
            if (onlineUserTransactionDetails==""){
                dispHistory.innerHTML=`No recent History`
                
                }
        }


        const displayIn = () =>{
            alert("I am runnig")
            // if 
        }
        


        // Hide and display account balance
        const displayBalance = () =>{
            if(displayMyBalance==false){
            accountBalance.innerHTML="***"
            dispBalance.innerHTML=`<i class="fa-solid fa-eye-slash"></i>`
            displayMyBalance = true
            
        }else{
            accountBalance.innerHTML = `${onlineUser.accountbalance}.00`
            displayMyBalance= false
            dispBalance.innerHTML=`<i class="fa-solid fa-eye "></i>`
                // console.log(onlineUser.accountbalance)
            }
        }

        copyAccNo.addEventListener("click", () =>{
            navigator.clipboard.writeText(dispAccNo.innerText)
        })

        // Dark Theme
        // const on =()=>{
        //     if (turnOnDarkMode==false){
        //         disp.style.background="black"
        //         // topNav.style.background="black"
        //         bottomNav.style.background="black"
        //         // disp.classList.add("bg-dark")
        //         turnOnDarkMode = true
        //         mode.innerHTML=`<i class="fa-solid fa-sun"></i>`
        //     }
        //     else if(turnOnDarkMode==true){
        //         disp.style.background="white"
        //         topNav.style.background="white"
        //         bottomNav.style.background="white"
        //         // disp.classList.add("bg-transparent")
        //         // disp.classList.add("bg-light")
        //         turnOnDarkMode = false
        //         mode.innerHTML=`<i class="fa-sharp fa-solid fa-moon"></i>`
        //     }
        // }

        // Send Money
        const transfer =()=>{
            // Checks if account number entered exist
            let findUser = allUsers.find((item, index)=> item.accountnumber== (transferTo.value))
            if (findUser && transferTo.value!=="" && transferAmount.value!==""){
                if (transferTo.value==onlineUser.accountnumber){
                    alert("You cannot send money to yourself, O wrong nauðŸ¤£")
                }else{
                    if ((transferAmount.value)> (onlineUser.accountbalance)){
                        alert("Insufficient Funds")
                        console.log(allUsers)
                    }else{
                        var send = confirm(`You are you sure you want to transfer N${transferAmount.value} to ${findUser.firstname} ${findUser.lastname} (${findUser.accountnumber})`)

                        if (send){
                        (findUser.accountbalance)+=Number(transferAmount.value)
                        onlineUser.accountbalance = ((onlineUser.accountbalance)-(transferAmount.value))
                        let date = new Date()
                        console.log(date.toLocaleDateString())
                        console.log(date.toLocaleTimeString())
                        // Stores Transfer information
                        var transferred ={
                                amountTransferred : transferAmount.value,
                                amountRecieved : transferAmount.value,
                                recieverAccountNumber : findUser.accountnumber,
                                recieverFirstname : findUser.firstname,
                                recieverLastname : findUser.lastname,
                                senderAccountNumber : onlineUser.accountnumber,
                                senderFirstname : onlineUser.firstname,
                                senderLastname : onlineUser.lastname,
                                dateSent : date.toLocaleDateString(),
                                timeSent : date.toLocaleTimeString(),
                                transactionId
                        } 
                        allTransfer.push(transferred)
                        console.log("All transfer")
                        console.log(allTransfer)
                        // To update sender balance in the array
                        updateAllUsers = allUsers.find((item, index)=> item.accountnumber==onlineUser.accountnumber)
                        updateAllUsers.accountbalance = onlineUser.accountbalance
                        console.log(updateAllUsers)
                        alert("You have successfully transferred ")
                        setTimeout(() => {
                            alert(`Wallet Balance Changed, You trasnferred N${transferAmount.value} to ${findUser.firstname} ${findUser.lastname} (${findUser.accountnumber})`)
                        }, 5000);
                        localStorage.setItem("usersList", JSON.stringify(allUsers))
                        localStorage.setItem("transferList", JSON.stringify(allTransfer))
                        localStorage.setItem('currentUser', JSON.stringify(onlineUser))
                        dispHistory.innerHTML="" 
                        display()
                        moneySent = true
                        countNotification ++
                        badgeNo.innerText = countNotification
                    }
                    }
                }
            }else{
                alert("Invalid beneficiary account number")
            }
        }

        console.log(allTransfer)

        const withdraw = () =>{
            countNotification-=1
            badgeNo.innerText = countNotification
        }
        
        
        transferTo.addEventListener('input', ()=>{
            let findUser = allUsers.find((item, index)=> item.accountnumber== (
                transferTo.value))
            if(findUser){
                accountName.innerText=`${findUser.firstname} ${findUser.lastname}`
            }else if (findUser!==true){
                accountName.innerText=""
                
            }
        })


        transferAmount.addEventListener('input', () =>{
            if(onlineUser.accountbalance < transferAmount.value){
                insufficientBalance.innerText=`Insufficient Balance`
            }else{
                insufficientBalance.innerText =``
            }
        })


        const notify =() =>{
            if (moneySent==true){
                
            } 
        }


        const profileDetails = () =>{
            userDetails.innerHTML=`
            <div class="">
                <div class="mt-4 d-flex justify-content-between" ><span class="fw-bold">ACCOUNT NAME:</span> <span class="text-uppercase">${onlineUser.firstname} ${onlineUser.lastname}</div>
                <div class="mt-4 d-flex justify-content-between" ><span class="fw-bold">ACCOUNT NUMBER:</span> <span class="text-uppercase"> ${onlineUser.accountnumber}</div>
                <div class="mt-4 d-flex justify-content-between" ><span class="fw-bold">EMAIL:</span> <span class="text-lowercase"> ${onlineUser.email}</div>
                    <div class="mt-4 d-flex justify-content-between" ><span class="fw-bold">PHONE NUMBER:</span> <span class="text-uppercase"> ${onlineUser.phoneNo}</div>
                <div class="mt-4 d-flex justify-content-between" ><small class="fw-bold">BANK VERIFICATION NUMBER(BVN):</small> <span class="text-uppercase"> ${onlineUser.bvn}</div>
                
            </div>
            
            `
        }



        const signOut = () =>{
            window.location="sign-in.html"
        }
        // print()
        console.log(onlineUserTransactionDetails)
        // display()
        
    </script>
</html>     